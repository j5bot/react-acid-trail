<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: ipsum-salt/loader.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: ipsum-salt/loader.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * ipsum-salt/loader module provides methods for loading single-file ipsum
 * generator modules and exposing them via the window object, allowing for lazy
 * loading of various ipsum generators.
 *
 * @module loader
 */

/**
 * Fetch a script from the URL using fetch API and returning a promise.
 * @param  {String} url URL of the script to fetch
 * @return {Promise}    A Promise which will resolve when the fetch operation
 *                      completes.
 */
const fetchScript = (url) => {
  return fetch(url).then(
    (response) => response.text()
  );
};

/**
 * Create script line(s) to expose module members on the `window` object.
 *
 * @param  {String} expose   The module member to expose
 * @param  {String} exposeAs What property to set on the `window` object
 * @return {String}          Script source for exposing the member
 */
const appendExposure = (expose, exposeAs) => {
  return `window['${exposeAs}'] = ${expose};`;
};

/**
 * Loader method which provides for loading single-file module scripts from
 * the given URL and exposing module members on the `window` object.
 *
 * Optionally call an `onLoad` callback when the module script is loaded.
 *
 * @param  {String} url               The URL to the module script
 * @param  {String} expose            The module member to expose
 * @param  {String} [exposeAs=expose] The property of `window` to set
 * @param  {Function} onLoad          A function to call when the script is
 *                                    loaded
 * @return {Promise}                  The Promise object used to fetch the
 *                                    module script
 */
export const ipsumSalt = ({ url, expose, exposeAs = expose, onLoad }) => {
  if (window.ipsumSalt.loadedScripts[url]) {
    return new Promise();
  }
  let promise = fetchScript(url).then(
    (response) => {
      const script = document.createElement('script');
      const exposureScript = appendExposure(expose, exposeAs);

      script.innerHTML = `
  var module = {
    exports: {}
  };

  var require = {};

  ${response}
  ${exposureScript}`;

      document.body.appendChild(script);
      window.ipsumSalt.loadedScripts.push(url);
    }
  );

  if (onLoad) {
    promise = promise.then(onLoad);
  }

  return promise;

};

/**
 * Collection of loaded module script URLs used to track whether a script has
 * already been loaded and so need not be loaded again.
 *
 * @type {Array}
 */
ipsumSalt.loadedScripts = [];

/**
 * Expose the {@link ipsumSalt} loader on the `window` object.
 * @type {Function}
 */
window.ipsumSalt = ipsumSalt;

export default ipsumSalt;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-AcidTrail.html">AcidTrail</a></li><li><a href="module-ColorMatch.html">ColorMatch</a></li><li><a href="module-colors.html">colors</a></li><li><a href="module-loader.html">loader</a></li><li><a href="module-NTC.html">NTC</a></li></ul><h3>Classes</h3><ul><li><a href="ConstructedWorker.html">ConstructedWorker</a></li><li><a href="HasherWorker.html">HasherWorker</a></li><li><a href="module-AcidTrail.AcidTrail.html">AcidTrail</a></li><li><a href="module-AcidTrail.Trail.html">Trail</a></li><li><a href="module-ColorMatch.ColorMatch.html">ColorMatch</a></li><li><a href="WorkerHasher.html">WorkerHasher</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Fri Nov 09 2018 15:03:10 GMT-0500 (Eastern Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
